<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- JavaScript -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous" />
  <link rel="stylesheet" type="text/css" href="css/vehicleInspect.css" />
  <link rel="stylesheet" type="text/css" href="css/dashboard.css" />
  <link rel="stylesheet" type="text/css" href="css/index.css" />
  <link rel="stylesheet" type="text/css" href="css/inspectPopup.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="vehicle.js"></script>
  <title>View</title>
</head>

<body>
  <div class="wrapper">
    <!-- Sidebar  -->
    <nav id="sidebar">
      <div class="sidebar-header">
        <!-- <button type="button" id="sidebarCollapse" class="btn btn_toggle">
                <i class="fa fa-bars" aria-hidden="true"></i>
              </button>
              <span>
                <h3>Trucks</h3>
              </span>
              <strong>TOT</strong> -->
      </div>
      <ul class="list-unstyled components mt-4 mx-2">
        <li class="active mt-1">
          <a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
            <i class="fa fa-th-large" aria-hidden="true"></i>
            Dashboard
          </a>
          <ul class="collapse list-unstyled" id="homeSubmenu">
            <li>
              <a href="vehicles.html">
                <i class="fa fa-truck" aria-hidden="true"></i>
                vehicles
              </a>
            </li>
            <li>
              <a href="drivers.html">
                <i class="fa fa-id-card" aria-hidden="true"></i>
                Drivers
              </a>
            </li>
            <li>
              <a href="inventory.html">
                <i class="fa fa-cogs" aria-hidden="true"></i>
                Inventory
              </a>
            </li>
          </ul>
        </li>
        <li>
          <a href="#">
            <i class="fa fa-calendar mt-3" aria-hidden="true"></i>
            Services
          </a>
          <a href="trip.html">
            <i class="fa fa-calendar mt-3" aria-hidden="true"></i>
            Trips
          </a>
          <a href="#">
            <i class="fa fa-question mt-3" aria-hidden="true"></i>
            Help
          </a>
          <a href="#">
            <i class="fa fa-sign-out mt-3" aria-hidden="true"></i>
            Log out
          </a>
        </li>
      </ul>
    </nav>
    <!-- Page Content  -->
    <div id="content">
      <nav class="navbar navbar-expand-lg navbar-light">
        <div class="dashHeader">
          <span>
            <!-- <button type="button" id="sidebarCollapse" class="btn btn_toggle">
                    <i class="fa fa-bars" aria-hidden="true"></i>
                  </button> -->
          </span>
          <span>
            <img src="images/truck.png" alt="" height="35" />
          </span>
        </div>
      </nav>

      <!-- popup for edit documents -->
      <div class="modal fade bd-example-modal-xl" id="vehicleEditDoc" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle">
                Document Update
              </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-md-6">
                  <img class="editDocPopup" src="images/edit_doc.png" height="300" alt="" />
                </div>
                <div class="col-md-6 editDocModal">
                  <form>
                    <div class="form-group">
                      <label for="edit_document_unique_id">Enter new unique ID</label>
                      <input type="email" class="form-control" id="edit_document_unique_id" aria-describedby="emailHelp"
                        >
                    </div>
                    <div class="form-group">
                      <label for="edit_document_start_date">Enter new start date
                      </label>
                      <input type="text" class="form-control" id="edit_document_start_date"
                        />
                    </div>
                    <div class="form-group">
                      <label for="edit_document_end_date">Enter new end date
                      </label>
                      <input type="text" class="form-control" id="edit_document_end_date"/>
                    </div>
                    <div class="form-group">
                      <label for="edit_document_file">Select new doc
                      </label>
                      <input type="file" class="form-control-file" id="edit_document_file" />
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Close
              </button>
              <button type="submit" onclick="modify_document_by_id()" class="btn btn-primary">Submit</button>
            </div>
          </div>
        </div>
      </div>

      <!-- popup for adding documents -->
      <div class="modal fade bd-example-modal-xl" id="vehicleAddDoc" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle">
                Add new document
              </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-md-6">
                  <img class="addDocPopup" src="images/add_doc.png" height="300" alt="" />
                </div>
                <div class="col-md-6 addDocModal">
                  <form>
                    <div class="form-group">
                      <label for="exampleInputEmail1">Enter new unique ID</label>
                      <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp"
                        placeholder="Enter new unique ID" />
                    </div>
                    <div class="form-group">
                      <label for="exampleInputPassword1">Enter new start date
                      </label>
                      <input type="date" class="form-control" id="exampleInputPassword1" placeholder="Password" />
                    </div>
                    <div class="form-group">
                      <label for="exampleInputPassword1">Enter new end date
                      </label>
                      <input type="date" class="form-control" id="exampleInputPassword1" placeholder="Password" />
                    </div>
                    <div class="form-group">
                      <label for="add_document_type">Select document</label>
                      <select id="add_document_type" class="form-control"></select>
                    </div>
                    <div class="form-group">
                      <label for="exampleFormControlFile1">Select new doc
                      </label>
                      <input type="file" class="form-control-file" id="exampleFormControlFile1" />
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Close
              </button>
              <button type="button" class="btn btn-primary">Submit</button>
            </div>
          </div>
        </div>
      </div>

      <!-- delete vehicle popup -->
      <div class="modal fade" id="vehicleDelete" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle">
                Are you sure?
              </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Are you sure you want to delete this vehicle.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">
                No
              </button>
              <button onclick="delete_data_by_id()" type="button" class="btn btn-primary">Yes</button>
            </div>
          </div>
        </div>
      </div>

      <!-- edit vehicle details -->
      <div class="modal fade bd-example-modal-xl" id="vehicleEditDetail" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle">
                Edit vehicle details
              </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-md-6">
                  <div class="cardImgEdit">
                    <div class="cardImgEditType">
                      <input type="file" id="inpp" name="image" accept=".png, .jpg, .jpeg" />
                      <label for="inpp"><i class="fa fa-plus" aria-hidden="true"></i></label>
                    </div>
                    <img id="edit_vehicle_image" class="cardImgEditPreview" src="images/vehicle_add.png">
                  </div>
                </div>
                <div class="col-md-6 editDocModal">
                  <form>
                    <div class="form-group">
                      <label for="edit_vehicle_name">Enter new name</label>
                      <input type="email" class="form-control" id="edit_vehicle_name" aria-describedby="emailHelp"
                        placeholder="Enter new unique ID" />
                    </div>
                    <div class="form-group">
                      <label for="edit_vehicle_number">Enter new vehicle number
                      </label>
                      <input type="text" class="form-control" id="edit_vehicle_number" placeholder="" />
                    </div>
                    <div class="form-group">
                      <label for="edit_vehicle_company">Enter new company
                      </label>
                      <input type="text" class="form-control" id="edit_vehicle_company" placeholder="" />
                    </div>
                    <div class="form-group">
                      <label for="edit_vehicle_category">Select new vehicle type
                      </label>
                      <select id="edit_vehicle_category" class="form-control"></select>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Close
              </button>
              <button type="button" onclick="change_vehicle_data()" class="btn btn-primary">Submit</button>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="vehicleInspectDetails">
          <div class="card">
            <div class="row">
              <div class="col-md-5">
                <div class="vehicleDetails">
                  <div class="cardImg">
                    <img id="vehicle_image" src="https://c1.staticflickr.com/3/2711/4350276437_60cafe56b9_b.jpg"
                      alt="" />
                  </div>
                  <div class="vehicleDetailsInner">
                    <h4 class="mb-3" style="color: white" id="vehicle_name"></h4>
                    <div class="row vehicleCardFooter">
                      <div class="col-md-12">
                        <div class="vehiclePlate">
                          <span class="vehiclePlateNumber" id="vehicle_number">
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="grid"></div>
                </div>
              </div>
              <div class="col-md-7">
                <!-- <button type="button" class="btn vehicleDataEdit"></button>
                    <button type="button" class="btn vehicleDataEdit"></button> -->
                <div class="dropdown">
                  <button class="btn threeDots" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    <input type="checkbox" class="custom" />
                    <div class="dots">
                      <span class="dot one"></span>
                      <span class="dot two"></span>
                      <span class="dot three"></span>
                    </div>
                    <!-- <hr> -->
                  </button>
                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                    <a type="button" class="btn dropdown-item editDetail" data-toggle="modal"
                      data-target="#vehicleEditDetail">
                      Edit details
                    </a>
                    <a type="button" class="btn dropdown-item editDetail" data-toggle="modal"
                      data-target="#vehicleDelete">
                      Delete Vehicle
                    </a>
                  </div>
                </div>
              </div>
              <div class="vehicleCompany">
                <p id="vehicle_company"></p>
              </div>
            </div>
          </div>
        </div>
        <div class="vehicle_document">
          <div class="vehicle_documentHeader">
            <h3>Vehicle Documents</h3>
            <button class="btn btn-primary" data-toggle="modal" data-target="#vehicleAddDoc">Add Documents</button>
          </div>
          <hr style="background-color: #424242" />
          <div id="certificates" class="row">
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
      integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
      crossorigin="anonymous"></script>
    <script type="text/javascript">
      var vehicle_data;
      var vehicle_category_data;
      var vehicle_document_type_data;
      var category_name;
      var category_id;
      var vehicle_document;
      var all_documents = {};
      var data;
      var id;
      var doc_id;
      var image64;
      var file64;
      var all_vehicle_document = {};
      var temp_document_id;
      $(document).ready(function () {
        id = window.location.href.split("=")[1];
        vehicle_data = get_data_by_id("vehicle", id);
        vehicle_category_data = fetch_data("vehicle_category");
        vehicle_document_type_data = fetch_data("vehicle_document_type");
        vehicle_document = get_data_by_id("vehicle_document", id);

        // console.log(file64);
        if (vehicle_data.error == false) {
          // ***************************************appended certificates******************************************
          for (var i = 0; i < vehicle_data.message.documents.length; i++) {
            $("#certificates").append(`
          <div class="col-md-4">
              <div class="card">
                <div class="box">
                  <p>${vehicle_data.message.documents[i].document_type}</p>
                  <a type="button" class="btn editDoc" onclick = "modify_document(${vehicle_data.message.documents[i].id})" data-toggle="modal" data-target="#vehicleEditDoc">
                    <i class="fa fa-pencil" aria-hidden="true"></i>
                  </a>
                  <a id="certificate_attachment_${vehicle_data.message.documents[i].id}" href="${vehicle_data.message.documents[i].attachment}" target="_blank" type="button" class="btn viewDoc">
                    <i class="fa fa-eye" aria-hidden="true"></i>
                  </a>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <p>Unique ID</p>
                  </div>
                  <div class="col-md-6">
                    <p id="certificate_uniqueID_${vehicle_data.message.documents[i].id}"> ${vehicle_data.message.documents[i].unique_id}</p>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <p>Start Date</p>
                  </div>
                  <div class="col-md-6">
                    <p id="certificate_startdate_${vehicle_data.message.documents[i].id}"> ${vehicle_data.message.documents[i].start_date}</p>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <p>End Date</p>
                  </div>
                  <div class="col-md-6">
                    <p id="certificate_enddate_${vehicle_data.message.documents[i].id}"> ${vehicle_data.message.documents[i].end_date}</p>
                  </div>
                </div>
              </div>
            </div>
          `)
          }
          // ******************************************************************************************************
          // **********************************appended vehicle category in form***********************************
          for (var i = 0; i < vehicle_category_data.message.data.length; i++) {
            if (
              vehicle_category_data.message.data[i].id ==
              vehicle_data.message.category
            ) {
              category_id = vehicle_category_data.message.data[i].id;
              category_name = vehicle_category_data.message.data[i].name;
              $("#edit_vehicle_category").append(
                '<option selected value="' +
                vehicle_category_data.message.data[i].id +
                '" >' +
                vehicle_category_data.message.data[i].name +
                "</option>"
              );
            } else {
              $("#edit_vehicle_category").append(
                '<option selected value="' +
                vehicle_category_data.message.data[i].id +
                '" >' +
                vehicle_category_data.message.data[i].name +
                "</option>"
              );
            }
          }
          // *****************************************************************************************************
          // *************************************appendend document type in form*********************************
          for (
            var i = 0;
            i < vehicle_document_type_data.message.data.length;
            i++
          ) {
            all_documents[vehicle_document_type_data.message.data[i].id] =
              vehicle_document_type_data.message.data[i];
            $("#add_document_type").append(
              '<option value="' +
              vehicle_document_type_data.message.data[i].id +
              '" >' +
              vehicle_document_type_data.message.data[i].title +
              "</option>"
            );
          }
          // *************************************appending data on vehicle card*********************************
          $("#vehicle_image").attr("src", vehicle_data.message.image);
          $("#vehicle_name").text(vehicle_data.message.name);
          $("#vehicle_number").text(vehicle_data.message.vehicle_number);
          $("#vehicle_company").text(vehicle_data.message.company);
          $("#vehicle_category").text(category_name);
          // **************************************appending data to edit popup***********************************
          $("#edit_vehicle_image").attr("src", vehicle_data.message.image);
          $("#edit_vehicle_name").val(vehicle_data.message.name);
          $("#edit_vehicle_number").val(vehicle_data.message.vehicle_number);
          $("#edit_vehicle_company").val(vehicle_data.message.company);
        } else {
          window.location.replace("vehicles.html");
        }
      });
      // if(vehicle_document.error == false){
      //     console.log(vehicle_document.message);
      //   }



      $("#inpp").change(function () {
        image64 = "";

        if (this.files && this.files[0]) {
          var FR = new FileReader();

          FR.addEventListener("load", function (e) {
            image64 = e.target.result;
            $("#edit_vehicle_image").attr("src", e.target.result);
            // document.getElementById("img").src = e.target.result;
            // document.getElementById("b64").innerHTML = e.target.result;
          });

          FR.readAsDataURL(this.files[0]);
        }
      });
      // *************************************change vehicle data*************************************************
      function change_vehicle_data() {
        console.log(image64);
        data = {
          name: $("#edit_vehicle_name").val(),
          vehicle_number: $("#edit_vehicle_number").val(),
          company: $("#edit_vehicle_company").val(),
          category: $("#edit_vehicle_category").val(),
        };
        if (image64 != "") {
          data["image"] = image64;
        }
        var response = modify_data_by_id("vehicle", id, data);

        if (response.error == false) {
          window.location.reload();
        }
      }

      $("#edit_document_file").change(function () {
        file64 = "";

        if (this.files && this.files[0]) {
          var FR = new FileReader();

          FR.addEventListener("load", function (e) {
            file64 = e.target.result;
            console.log(file64);
          });

          FR.readAsDataURL(this.files[0]);
        }
      });

      $("#add_document_file").change(function () {
        file64 = "";

        if (this.files && this.files[0]) {
          var FR = new FileReader();

          FR.addEventListener("load", function (e) {
            file64 = e.target.result;
            console.log(file64);
          });

          FR.readAsDataURL(this.files[0]);
        }
      });
      // *********************************************delete data by id*********************************************
      // function delete_data_by_id() {

      // }
      // ***********************************************************************************************************      
      // *********************************************modify document***********************************************
      function modify_document(id) {
        temp_document_id = id;
        // console.log(id);
        // modify_document_by_id(temp_document_id);
        $("#edit_document_unique_id").val($("#certificate_uniqueID_"+id).html());
        $("#edit_document_start_date").val($("#certificate_startdate_"+id).html());
        $("#edit_document_end_date").val($("#certificate_enddate_"+id).html());
        $("edit_document_file").val($("#certificate_attachment_"+id).html());
        // $("#edit_document_button").val(id);
      }
      // ***********************************************************************************************************      
      // ******************************************modify document by id********************************************
      function modify_document_by_id() {
        id = temp_document_id;
        data = {
          unique_id: $("#edit_document_unique_id").val(),
          start_date: $("#edit_document_start_date").val(),
          end_date: $("#edit_document_end_date").val(),
          attachment: $("#edit_document_file").val(),
        };
        // console.log(file64);
        if (file64 != "") {
          data["attachment"] = file64;
        }
        console.log(data);
        var response = modify_data_by_id("vehicle_document", id, data);
        console.log(response.error);

        if (response.error == false) {
          window.location.reload();
        }
      }
      // ***********************************************************************************************************     
      // ********************************************add new document***********************************************
      function add_new_document() {
        data = {
          unique_id: $("#add_document_unique_id").val(),
          vehicle_id: id,
          document_type: $("#add_document_type").val(),
          attachment: file64,
          start_date: $("#add_document_start_date").val(),
          end_date: $("#add_document_end_date").val(),
        };

        var response = add_data("vehicle_document", data);

        console.log(response);

        if (response.error == false) {
          window.location.reload();
        }
      }
      // ***********************************************************************************************************
      // **********************************************side bar collapse********************************************
      $(document).ready(function () {
        $("#sidebarCollapse").on("click", function () {
          $("#sidebar").toggleClass("active");
        });
      });
    </script>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

</html>